AWSTemplateFormatVersion: 2010-09-09
Description: >-
  AWS CloudFormation Sample Template VPC_Single_Instance_In_Subnet: Sample
  template showing how to create a VPC and add an EC2 instance with an Elastic
  IP address and a security group. **WARNING** This template creates an Amazon
  EC2 instance. You will be billed for the AWS resources used if you create a
  stack from this template.
Parameters:
  KeyName:
    Description: Name of an existing EC2 KeyPair to enable SSH access to the instance
    Type: 'AWS::EC2::KeyPair::KeyName'
    ConstraintDescription: must be the name of an existing EC2 KeyPair.
Resources:
  VPC:
    Type: 'AWS::EC2::VPC'
    Properties:
      EnableDnsSupport: 'true'
      EnableDnsHostnames: 'true'
      CidrBlock: 10.0.0.0/16
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 509f11b3-ef83-44fc-892e-bc3e79fbf7e5
  PublicSubnet:
    Type: 'AWS::EC2::Subnet'
    Properties:
      VpcId: !Ref VPC
      CidrBlock: 10.0.0.0/24
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 8ac904fc-c5cd-45ec-8c51-e45eca6b4627
  InternetGateway:
    Type: 'AWS::EC2::InternetGateway'
    Properties:
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 974134fa-bb42-40a0-a7c0-a906cd8d53b5
  VPCGatewayAttachment:
    Type: 'AWS::EC2::VPCGatewayAttachment'
    Properties:
      VpcId: !Ref VPC
      InternetGatewayId: !Ref InternetGateway
    Metadata:
      'AWS::CloudFormation::Designer':
        id: de7cff44-1608-42db-803f-aca7dcab5df1
  PublicRouteTable:
    Type: 'AWS::EC2::RouteTable'
    Properties:
      VpcId: !Ref VPC
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
  PublicRoute:
    Type: 'AWS::EC2::Route'
    DependsOn: VPCGatewayAttachment
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway
    Metadata:
      'AWS::CloudFormation::Designer':
        id: a4db911d-84dd-427c-a181-07cf826d589a
  PublicSubnetRouteTableAssociation:
    Type: 'AWS::EC2::SubnetRouteTableAssociation'
    Properties:
      SubnetId: !Ref PublicSubnet
      RouteTableId: !Ref PublicRouteTable
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 8693a5d7-d01d-461b-b39e-11df0123e848
  PublicSubnetNetworkAclAssociation:
    Type: 'AWS::EC2::SubnetNetworkAclAssociation'
    Properties:
      SubnetId: !Ref PublicSubnet
      NetworkAclId: !GetAtt
        - VPC
        - DefaultNetworkAcl        
  # PublicNetworkAcl:
  #   Type: 'AWS::EC2::NetworkAcl'
  #   Properties:
  #     VpcId: !Ref VPC
  #     Tags:
  #       - Key: Application
  #         Value: !Ref 'AWS::StackId'
  #   Metadata:
  #     'AWS::CloudFormation::Designer':
  #       id: 040ee814-b862-4e26-b6b8-2fe201a3461e
  # InboundHTTPNetworkAclEntry:
  #   Type: 'AWS::EC2::NetworkAclEntry'
  #   Properties:
  #     NetworkAclId: !Ref PublicNetworkAcl
  #     RuleNumber: '100'
  #     Protocol: '6'
  #     RuleAction: allow
  #     Egress: 'false'
  #     CidrBlock: 0.0.0.0/0
  #     PortRange:
  #       From: '80'
  #       To: '80'
  #   Metadata:
  #     'AWS::CloudFormation::Designer':
  #       id: 4bbfb083-0b54-43e8-8c5e-3abe04918eb6
  # OutBoundHTTPNetworkAclEntry:
  #   Type: 'AWS::EC2::NetworkAclEntry'
  #   Properties:
  #     NetworkAclId: !Ref PublicNetworkAcl
  #     RuleNumber: '101'
  #     Protocol: '6'
  #     RuleAction: allow
  #     Egress: 'true'
  #     CidrBlock: 0.0.0.0/0
  #     PortRange:
  #       From: '80'
  #       To: '80'
  #   Metadata:
  #     'AWS::CloudFormation::Designer':
  #       id: 7c4a00bb-dbfd-4fc4-b209-ee8bfbe7e7e4
  # InboundHTTPSNetworkAclEntry:
  #   Type: 'AWS::EC2::NetworkAclEntry'
  #   Properties:
  #     NetworkAclId: !Ref PublicNetworkAcl
  #     RuleNumber: '102'
  #     Protocol: '6'
  #     RuleAction: allow
  #     Egress: 'false'
  #     CidrBlock: 0.0.0.0/0
  #     PortRange:
  #       From: '443'
  #       To: '443'
  #   Metadata:
  #     'AWS::CloudFormation::Designer':
  #       id: cf3b6470-f42d-4f4d-b9ed-8cc1f09ac4f9
  # OutBoundHTTPSNetworkAclEntry:
  #   Type: 'AWS::EC2::NetworkAclEntry'
  #   Properties:
  #     NetworkAclId: !Ref PublicNetworkAcl
  #     RuleNumber: '103'
  #     Protocol: '6'
  #     RuleAction: allow
  #     Egress: 'true'
  #     CidrBlock: 0.0.0.0/0
  #     PortRange:
  #       From: '443'
  #       To: '443'
  #   Metadata:
  #     'AWS::CloudFormation::Designer':
  #       id: 20751781-1694-47a0-91e1-fbe26070a977
  # InboundSSHNetworkAclEntry:
  #   Type: 'AWS::EC2::NetworkAclEntry'
  #   Properties:
  #     NetworkAclId: !Ref PublicNetworkAcl
  #     RuleNumber: '104'
  #     Protocol: '6'
  #     RuleAction: allow
  #     Egress: 'false'
  #     CidrBlock: 0.0.0.0/0
  #     PortRange:
  #       From: '22'
  #       To: '22'
  #   Metadata:
  #     'AWS::CloudFormation::Designer':
  #       id: a4daca71-0038-41d5-ae13-e3ec8ee0ed93
  # OutboundSSHNetworkAclEntry:
  #   Type: 'AWS::EC2::NetworkAclEntry'
  #   Properties:
  #     NetworkAclId: !Ref PublicNetworkAcl
  #     RuleNumber: '105'
  #     Protocol: '6'
  #     RuleAction: allow
  #     Egress: 'true'
  #     CidrBlock: 0.0.0.0/0
  #     PortRange:
  #       From: '22'
  #       To: '22'
  #   Metadata:
  #     'AWS::CloudFormation::Designer':
  #       id: a5a0b7b4-da38-4385-adc9-b320f2445ba0
  # PublicSubnetNetworkAclAssociation:
  #   Type: 'AWS::EC2::SubnetNetworkAclAssociation'
  #   Properties:
  #     SubnetId: !Ref PublicSubnet
  #     NetworkAclId: !Ref PublicNetworkAcl
  #   Metadata:
  #     'AWS::CloudFormation::Designer':
  #       id: 545e3c33-19f9-48b4-bfc0-843261c88b1b
  InstanceSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      VpcId: !Ref VPC
      GroupDescription: Enable HTTP access via port 80, HTTPS access via 443 & SSH access via port 22
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: '22'
          ToPort: '22'
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: '80'
          ToPort: '80'
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: '443'
          ToPort: '443'
          CidrIp: 0.0.0.0/0
    Metadata:
      'AWS::CloudFormation::Designer':
        id: f0b41499-dd3f-4347-bbd0-d680760dea2d
Outputs:
  VPCId:
    Description: VPC ID
    Value: !Ref VPC
    Export:
      Name: !Sub '${AWS::StackName}-VPCID'
  PublicSubnet:
    Description: The subnet ID to use for public web servers
    Value: !Ref PublicSubnet
    Export:
      Name: !Sub '${AWS::StackName}-SubnetID'
  InstanceSecurityGroup:
    Description: The security group ID to use for public servers
    Value: !GetAtt
      - InstanceSecurityGroup
      - GroupId
    Export:
      Name: !Sub '${AWS::StackName}-SecurityGroupID'
Metadata:
  'AWS::CloudFormation::Designer':
    974134fa-bb42-40a0-a7c0-a906cd8d53b5:
      size:
        width: 60
        height: 60
      position:
        x: 980
        'y': 600
      z: 1
      embeds: []
    509f11b3-ef83-44fc-892e-bc3e79fbf7e5:
      size:
        width: 780
        height: 780
      position:
        x: 60
        'y': 90
      z: 1
      embeds:
        - f0b41499-dd3f-4347-bbd0-d680760dea2d
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
    f0b41499-dd3f-4347-bbd0-d680760dea2d:
      size:
        width: 60
        height: 60
      position:
        x: 570
        'y': 150
      z: 2
      parent: 509f11b3-ef83-44fc-892e-bc3e79fbf7e5
      embeds: []
      iscontainedinside:
        - 509f11b3-ef83-44fc-892e-bc3e79fbf7e5
    040ee814-b862-4e26-b6b8-2fe201a3461e:
      size:
        width: 420
        height: 330
      position:
        x: 90
        'y': 150
      z: 2
      parent: 509f11b3-ef83-44fc-892e-bc3e79fbf7e5
      embeds:
        - a5a0b7b4-da38-4385-adc9-b320f2445ba0
        - cf3b6470-f42d-4f4d-b9ed-8cc1f09ac4f9
        - 20751781-1694-47a0-91e1-fbe26070a977
        - a4daca71-0038-41d5-ae13-e3ec8ee0ed93
        - 7c4a00bb-dbfd-4fc4-b209-ee8bfbe7e7e4
        - 4bbfb083-0b54-43e8-8c5e-3abe04918eb6
      iscontainedinside:
        - 509f11b3-ef83-44fc-892e-bc3e79fbf7e5
    20751781-1694-47a0-91e1-fbe26070a977:
      size:
        width: 60
        height: 60
      position:
        x: 240
        'y': 330
      z: 3
      parent: 040ee814-b862-4e26-b6b8-2fe201a3461e
      embeds: []
      iscontainedinside:
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
    7c4a00bb-dbfd-4fc4-b209-ee8bfbe7e7e4:
      size:
        width: 60
        height: 60
      position:
        x: 120
        'y': 330
      z: 3
      parent: 040ee814-b862-4e26-b6b8-2fe201a3461e
      embeds: []
      iscontainedinside:
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
    a4daca71-0038-41d5-ae13-e3ec8ee0ed93:
      size:
        width: 60
        height: 60
      position:
        x: 360
        'y': 210
      z: 3
      parent: 040ee814-b862-4e26-b6b8-2fe201a3461e
      embeds: []
      iscontainedinside:
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
    4bbfb083-0b54-43e8-8c5e-3abe04918eb6:
      size:
        width: 60
        height: 60
      position:
        x: 120
        'y': 210
      z: 3
      parent: 040ee814-b862-4e26-b6b8-2fe201a3461e
      embeds: []
      iscontainedinside:
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
    3e23ed71-da77-4ea9-9044-f46f6fdf2c5d:
      size:
        width: 240
        height: 240
      position:
        x: 390
        'y': 540
      z: 2
      parent: 509f11b3-ef83-44fc-892e-bc3e79fbf7e5
      embeds:
        - a4db911d-84dd-427c-a181-07cf826d589a
      iscontainedinside:
        - 509f11b3-ef83-44fc-892e-bc3e79fbf7e5
    de7cff44-1608-42db-803f-aca7dcab5df1:
      source:
        id: 509f11b3-ef83-44fc-892e-bc3e79fbf7e5
      target:
        id: 974134fa-bb42-40a0-a7c0-a906cd8d53b5
      z: 1
    a4db911d-84dd-427c-a181-07cf826d589a:
      size:
        width: 60
        height: 60
      position:
        x: 420
        'y': 600
      z: 3
      parent: 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
      embeds: []
      isassociatedwith:
        - 974134fa-bb42-40a0-a7c0-a906cd8d53b5
      iscontainedinside:
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
        - 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
      dependson:
        - de7cff44-1608-42db-803f-aca7dcab5df1
    8ac904fc-c5cd-45ec-8c51-e45eca6b4627:
      size:
        width: 240
        height: 240
      position:
        x: 90
        'y': 660
      z: 2
      embeds: []
      iscontainedinside:
        - 509f11b3-ef83-44fc-892e-bc3e79fbf7e5
    545e3c33-19f9-48b4-bfc0-843261c88b1b:
      source:
        id: 040ee814-b862-4e26-b6b8-2fe201a3461e
      target:
        id: 8ac904fc-c5cd-45ec-8c51-e45eca6b4627
      z: 2
    8693a5d7-d01d-461b-b39e-11df0123e848:
      source:
        id: 3e23ed71-da77-4ea9-9044-f46f6fdf2c5d
      target:
        id: 8ac904fc-c5cd-45ec-8c51-e45eca6b4627
      z: 2
    cf3b6470-f42d-4f4d-b9ed-8cc1f09ac4f9:
      size:
        width: 60
        height: 60
      position:
        x: 240
        'y': 210
      z: 3
      parent: 040ee814-b862-4e26-b6b8-2fe201a3461e
      embeds: []
      iscontainedinside:
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
    a5a0b7b4-da38-4385-adc9-b320f2445ba0:
      size:
        width: 60
        height: 60
      position:
        x: 360
        'y': 330
      z: 3
      parent: 040ee814-b862-4e26-b6b8-2fe201a3461e
      embeds: []
      iscontainedinside:
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
        - 040ee814-b862-4e26-b6b8-2fe201a3461e
