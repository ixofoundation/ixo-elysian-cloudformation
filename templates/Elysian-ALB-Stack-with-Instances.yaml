AWSTemplateFormatVersion: 2010-09-09
Description: >-
  AWS CloudFormation template instantiating a Network stack for Cross-Stack
  utilization, exporting VPC, Subnet & SecurityGroup
Resources:
  VPC:
    Type: 'AWS::EC2::VPC'
    Properties:
      EnableDnsSupport: 'true'
      EnableDnsHostnames: 'true'
      CidrBlock: 10.0.0.0/16
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: e707e103-85ca-46c3-81aa-cc023be37c61
  PublicSubnetA:
    Type: 'AWS::EC2::Subnet'
    Properties:
      VpcId: !Ref VPC
      CidrBlock: 10.0.0.0/24
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 16a9b5b9-a9eb-484d-b5b1-f2fec3ed1f83
  InternetGateway:
    Type: 'AWS::EC2::InternetGateway'
    Properties:
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 7281c844-5411-4d45-a21b-da763f1e0b28
  VPCGatewayAttachment:
    Type: 'AWS::EC2::VPCGatewayAttachment'
    Properties:
      VpcId: !Ref VPC
      InternetGatewayId: !Ref InternetGateway
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 7eef9d3e-c9c9-4443-90b3-861c4b7b375c
  PublicRouteTable:
    Type: 'AWS::EC2::RouteTable'
    Properties:
      VpcId: !Ref VPC
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 6f69025b-5908-4c8a-98db-d9fa1985aab2
  PublicRoute:
    Type: 'AWS::EC2::Route'
    DependsOn: VPCGatewayAttachment
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 8c6bce39-f60c-4287-a88f-e79ea372248f
  PublicNetworkAcl:
    Type: 'AWS::EC2::NetworkAcl'
    Properties:
      VpcId: !Ref VPC
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 5a55fc3b-ecb4-4de1-bdcb-b65861904227
  LoadBalancer:
    Type: 'AWS::ElasticLoadBalancingV2::LoadBalancer'
    Properties:
      Type: application
      Scheme: internet-facing
      Subnets:
        - !Ref PublicSubnetA
      SecurityGroups:
        - !Ref LoadBalancerSecurityGroup
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 14d901e9-f4ff-4d3d-8b03-34112dbe4e2b
  LoadBalancerSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      VpcId: !Ref VPC
      GroupDescription: >-
        Enable HTTP access via port 80, HTTPS access via 443 & SSH access via
        port 22
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: '22'
          ToPort: '22'
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: '80'
          ToPort: '80'
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: '443'
          ToPort: '443'
          CidrIp: 0.0.0.0/0
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 8281ebd8-29ce-4471-9fbc-2709f5115775
  PublicSubnetARouteTableAssociation:
    Type: 'AWS::EC2::SubnetRouteTableAssociation'
    Properties:
      SubnetId: !Ref PublicSubnetA
      RouteTableId: !Ref PublicRouteTable
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 1b425fef-d56e-4514-b198-1ce5e6411ebc
  PublicSubnetANetworkAclAssociation:
    Type: 'AWS::EC2::SubnetNetworkAclAssociation'
    Properties:
      NetworkAclId: !Ref PublicNetworkAcl
      SubnetId: !Ref PublicSubnetA
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 45c91818-56f2-495f-b955-4ff3e6187be8
Outputs:
  VPCId:
    Description: VPC ID
    Value: !Ref VPC
    Export:
      Name: !Sub '${AWS::StackName}-VPCId'
  PublicSubnetA:
    Description: The subnet ID to use for public web servers
    Value: !Ref PublicSubnetA
    Export:
      Name: !Sub '${AWS::StackName}-SubnetId'
  LoadBalancerSecurityGroup:
    Description: The security group ID to use for public servers
    Value: !GetAtt 
      - LoadBalancerSecurityGroup
      - GroupId
    Export:
      Name: !Sub '${AWS::StackName}-SecurityGroupId'
  AvailabilityZoneA:
    Description: Availability zone A to use for volumes
    Value: !GetAtt 
      - PublicSubnetA
      - AvailabilityZone
    Export:
      Name: !Sub '${AWS::StackName}-AvailabilityZone'
Metadata:
  'AWS::CloudFormation::Designer':
    7281c844-5411-4d45-a21b-da763f1e0b28:
      size:
        width: 60
        height: 60
      position:
        x: 170
        'y': 70
      z: 0
      embeds: []
    e707e103-85ca-46c3-81aa-cc023be37c61:
      size:
        width: 450
        height: 510
      position:
        x: 290
        'y': -250
      z: 0
      embeds:
        - 8281ebd8-29ce-4471-9fbc-2709f5115775
        - 5a55fc3b-ecb4-4de1-bdcb-b65861904227
        - 6f69025b-5908-4c8a-98db-d9fa1985aab2
        - 16a9b5b9-a9eb-484d-b5b1-f2fec3ed1f83
        - 14d901e9-f4ff-4d3d-8b03-34112dbe4e2b
    16a9b5b9-a9eb-484d-b5b1-f2fec3ed1f83:
      size:
        width: 180
        height: 110
      position:
        x: 540
        'y': -80
      z: 1
      parent: e707e103-85ca-46c3-81aa-cc023be37c61
      embeds: []
      iscontainedinside:
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
    7eef9d3e-c9c9-4443-90b3-861c4b7b375c:
      source:
        id: e707e103-85ca-46c3-81aa-cc023be37c61
      target:
        id: 7281c844-5411-4d45-a21b-da763f1e0b28
      z: 0
    6f69025b-5908-4c8a-98db-d9fa1985aab2:
      size:
        width: 190
        height: 110
      position:
        x: 320
        'y': -210
      z: 1
      parent: e707e103-85ca-46c3-81aa-cc023be37c61
      embeds: []
      iscontainedinside:
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
    8c6bce39-f60c-4287-a88f-e79ea372248f:
      size:
        width: 60
        height: 60
      position:
        x: 170
        'y': -220
      z: 0
      embeds: []
      isassociatedwith:
        - 7281c844-5411-4d45-a21b-da763f1e0b28
      iscontainedinside:
        - 6f69025b-5908-4c8a-98db-d9fa1985aab2
      dependson:
        - 7eef9d3e-c9c9-4443-90b3-861c4b7b375c
    1b425fef-d56e-4514-b198-1ce5e6411ebc:
      source:
        id: 6f69025b-5908-4c8a-98db-d9fa1985aab2
      target:
        id: 16a9b5b9-a9eb-484d-b5b1-f2fec3ed1f83
      z: 1
    8281ebd8-29ce-4471-9fbc-2709f5115775:
      size:
        width: 60
        height: 60
      position:
        x: 400
        'y': -60
      z: 1
      parent: e707e103-85ca-46c3-81aa-cc023be37c61
      embeds: []
      iscontainedinside:
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
    5a55fc3b-ecb4-4de1-bdcb-b65861904227:
      size:
        width: 130
        height: 80
      position:
        x: 560
        'y': -210
      z: 1
      parent: e707e103-85ca-46c3-81aa-cc023be37c61
      embeds: []
      iscontainedinside:
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
    45c91818-56f2-495f-b955-4ff3e6187be8:
      source:
        id: 5a55fc3b-ecb4-4de1-bdcb-b65861904227
      target:
        id: 16a9b5b9-a9eb-484d-b5b1-f2fec3ed1f83
      z: 1
    14d901e9-f4ff-4d3d-8b03-34112dbe4e2b:
      size:
        width: 60
        height: 60
      position:
        x: 320
        'y': -10
      z: 1
      parent: e707e103-85ca-46c3-81aa-cc023be37c61
      embeds: []
      isassociatedwith:
        - 8281ebd8-29ce-4471-9fbc-2709f5115775
        - 9f177d7e-97f7-4e62-8ea3-bd501d29e032
      iscontainedinside:
        - 16a9b5b9-a9eb-484d-b5b1-f2fec3ed1f83
