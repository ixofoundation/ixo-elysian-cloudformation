AWSTemplateFormatVersion: 2010-09-09
Description: >-
  AWS CloudFormation template instantiating a Network stack for Cross-Stack
  utilization, exporting VPC, Subnet & SecurityGroup
Resources:
  VPC:
    Type: 'AWS::EC2::VPC'
    Properties:
      EnableDnsSupport: 'true'
      EnableDnsHostnames: 'true'
      CidrBlock: 10.0.0.0/16
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: e707e103-85ca-46c3-81aa-cc023be37c61
  PublicSubnet:
    Type: 'AWS::EC2::Subnet'
    Properties:
      VpcId: !Ref VPC
      CidrBlock: 10.0.0.0/24
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 16a9b5b9-a9eb-484d-b5b1-f2fec3ed1f83
  InternetGateway:
    Type: 'AWS::EC2::InternetGateway'
    Properties:
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 7281c844-5411-4d45-a21b-da763f1e0b28
  VPCGatewayAttachment:
    Type: 'AWS::EC2::VPCGatewayAttachment'
    Properties:
      VpcId: !Ref VPC
      InternetGatewayId: !Ref InternetGateway
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 7eef9d3e-c9c9-4443-90b3-861c4b7b375c
  PublicRouteTable:
    Type: 'AWS::EC2::RouteTable'
    Properties:
      VpcId: !Ref VPC
      Tags:
        - Key: Application
          Value: !Ref 'AWS::StackId'
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 6f69025b-5908-4c8a-98db-d9fa1985aab2
  PublicRoute:
    Type: 'AWS::EC2::Route'
    DependsOn: VPCGatewayAttachment
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 8c6bce39-f60c-4287-a88f-e79ea372248f
  PublicSubnetRouteTableAssociation:
    Type: 'AWS::EC2::SubnetRouteTableAssociation'
    Properties:
      SubnetId: !Ref PublicSubnet
      RouteTableId: !Ref PublicRouteTable
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 1b425fef-d56e-4514-b198-1ce5e6411ebc
  InstanceSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    Properties:
      VpcId: !Ref VPC
      GroupDescription: Enable HTTP access via port 80, HTTPS access via 443 & SSH access via port 22
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: '22'
          ToPort: '22'
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: '80'
          ToPort: '80'
          CidrIp: 0.0.0.0/0
        - IpProtocol: tcp
          FromPort: '443'
          ToPort: '443'
          CidrIp: 0.0.0.0/0
    Metadata:
      'AWS::CloudFormation::Designer':
        id: 8281ebd8-29ce-4471-9fbc-2709f5115775
Outputs:
  VPCId:
    Description: VPC ID
    Value: !Ref VPC
    Export:
      Name: !Sub '${AWS::StackName}-VPCId'
  PublicSubnet:
    Description: The subnet ID to use for public web servers
    Value: !Ref PublicSubnet
    Export:
      Name: !Sub '${AWS::StackName}-SubnetId'
  InstanceSecurityGroup:
    Description: The security group ID to use for public servers
    Value: !GetAtt 
      - InstanceSecurityGroup
      - GroupId
    Export:
      Name: !Sub '${AWS::StackName}-SecurityGroupId'
  AvailabilityZone:
    Description: The availability zone to use for volumes
    Value: !GetAtt 
      - PublicSubnet
      - AvailabilityZone
    Export:
      Name: !Sub '${AWS::StackName}-AvailabilityZone'
Metadata:
  'AWS::CloudFormation::Designer':
    7281c844-5411-4d45-a21b-da763f1e0b28:
      size:
        width: 60
        height: 60
      position:
        x: 170
        'y': -70
      z: 0
      embeds: []
    e707e103-85ca-46c3-81aa-cc023be37c61:
      size:
        width: 330
        height: 340
      position:
        x: 290
        'y': -250
      z: 0
      embeds:
        - 8281ebd8-29ce-4471-9fbc-2709f5115775
        - 6f69025b-5908-4c8a-98db-d9fa1985aab2
        - 16a9b5b9-a9eb-484d-b5b1-f2fec3ed1f83
    16a9b5b9-a9eb-484d-b5b1-f2fec3ed1f83:
      size:
        width: 190
        height: 120
      position:
        x: 390
        'y': -40
      z: 1
      parent: e707e103-85ca-46c3-81aa-cc023be37c61
      embeds: []
      iscontainedinside:
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
    7eef9d3e-c9c9-4443-90b3-861c4b7b375c:
      source:
        id: e707e103-85ca-46c3-81aa-cc023be37c61
      target:
        id: 7281c844-5411-4d45-a21b-da763f1e0b28
      z: 0
    6f69025b-5908-4c8a-98db-d9fa1985aab2:
      size:
        width: 190
        height: 110
      position:
        x: 330
        'y': -200
      z: 1
      parent: e707e103-85ca-46c3-81aa-cc023be37c61
      embeds: []
      iscontainedinside:
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
    8c6bce39-f60c-4287-a88f-e79ea372248f:
      size:
        width: 60
        height: 60
      position:
        x: 170
        'y': -220
      z: 0
      embeds: []
      isassociatedwith:
        - 7281c844-5411-4d45-a21b-da763f1e0b28
      iscontainedinside:
        - 6f69025b-5908-4c8a-98db-d9fa1985aab2
      dependson:
        - 7eef9d3e-c9c9-4443-90b3-861c4b7b375c
    1b425fef-d56e-4514-b198-1ce5e6411ebc:
      source:
        id: 6f69025b-5908-4c8a-98db-d9fa1985aab2
      target:
        id: 16a9b5b9-a9eb-484d-b5b1-f2fec3ed1f83
      z: 1
    8281ebd8-29ce-4471-9fbc-2709f5115775:
      size:
        width: 60
        height: 60
      position:
        x: 540
        'y': -230
      z: 1
      parent: e707e103-85ca-46c3-81aa-cc023be37c61
      embeds: []
      iscontainedinside:
        - e707e103-85ca-46c3-81aa-cc023be37c61
        - e707e103-85ca-46c3-81aa-cc023be37c61
